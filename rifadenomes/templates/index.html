<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escolha Nomes</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <h1>Escolha Nomes</h1>
    <form id="formulario" action="/salvar" method="POST">
        <div id="nomes"></div> <!-- Updated container for names -->
        <input type="text" name="nome" placeholder="Seu nome" required>
        <input type="hidden" id="escolhas" name="escolhas" value="">
        <button type="submit">Enviar</button>
    </form>

    <script>
        const nomesDiv = document.getElementById("nomes");
        const escolhasInput = document.getElementById("escolhas");
        const nomesEscolhidos = new Set();

        // Fetch the list of names and already chosen names
        fetch('/nomes')
            .then(response => response.json())
            .then(data => {
                const allNames = data.all_names; // **Updated to handle "1. Alex" format**
                const takenNames = new Set(data.taken_names);

                // Generate name boxes
                allNames.forEach(fullName => {
                    const nameBox = document.createElement("div");
                    nameBox.classList.add("nome");
                    nameBox.textContent = fullName; // **Display the formatted name**

                    // Disable already chosen names
                    if (takenNames.has(fullName)) {
                        nameBox.classList.add("desabilitado");
                    } else {
                        nameBox.addEventListener("click", () => {
                            if (nomesEscolhidos.has(fullName)) {
                                nomesEscolhidos.delete(fullName);
                                nameBox.classList.remove("selecionado");
                            } else {
                                nomesEscolhidos.add(fullName);
                                nameBox.classList.add("selecionado");
                            }
                            escolhasInput.value = Array.from(nomesEscolhidos).join(",");
                        });
                    }
                    nomesDiv.appendChild(nameBox);
                });
            })
            .catch(error => console.error('Erro ao buscar nomes:', error));
    </script>
</body>

</html>
