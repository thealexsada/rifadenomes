{% extends "layout.html" %}

{% block body %}
    <h1>Escolha Nomes</h1>
    <form action="/register" method="POST">
        <div id="nomes">
            {% for name in names %}
                <div
                    class="nome {% if name in taken_names %}desabilitado{% endif %}"
                    data-name="{{ name }}"
                >
                    {{ name }}
                </div>
            {% endfor %}
        </div>
        <input type="hidden" id="selectedName" name="name" value="">
        <input autocomplete="off" autofocus type="text" name="registrant" placeholder="Seu nome" required>
        <button type="submit">Registrar</button>
    </form>
    <script>
        // Select DOM elements
        const tiles = document.querySelectorAll('.nome');
        const selectedNamesInput = document.getElementById('selectedNames');
        const selectedNames = new Set();

        tiles.forEach(tile => {
            // Ensure only enabled tiles are clickable
            if (!tile.classList.contains('desabilitado')) {
                tile.addEventListener('click', () => {
                    const name = tile.getAttribute('data-name');

                    if (tile.classList.contains('selecionado')) {
                        // Deselect the tile
                        tile.classList.remove('selecionado');
                        selectedNames.delete(name);
                    } else {
                        // Select the tile
                        tile.classList.add('selecionado');
                        selectedNames.add(name);
                    }

                    // Update the hidden input with the selected names
                    selectedNamesInput.value = Array.from(selectedNames).join(',');
                });
            }
        });
    </script>
{% endblock %}
